{% extends 'base.html.twig' %}

{% block title %}Mes Ã©vÃ©nements Â· GoRun{% endblock %}

{% block body %}
<div class="max-w-6xl mx-auto">
  
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl md:text-3xl font-bold">Mes Ã©vÃ©nements</h1>
    <a href="{{ path('app_profile') }}" class="text-green-600 hover:text-green-700 font-medium">
      â† Retour au profil
    </a>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-{{ isAdmin ? '3' : '2' }} gap-4 mb-8">
    
    <div class="bg-white rounded-2xl shadow p-6">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
          <span class="text-2xl">ğŸƒ</span>
        </div>
        <div>
          <p class="text-3xl font-bold text-gray-900">{{ stats.totalParticipations }}</p>
          <p class="text-sm text-gray-600">Participation{{ stats.totalParticipations > 1 ? 's' : '' }}</p>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-2xl shadow p-6">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
          <span class="text-2xl">ğŸ“</span>
        </div>
        <div>
          <p class="text-3xl font-bold text-gray-900">{{ stats.totalKilometers|number_format(1, ',', ' ') }}</p>
          <p class="text-sm text-gray-600">KilomÃ¨tres parcourus</p>
        </div>
      </div>
    </div>

    {% if isAdmin %}
      <div class="bg-white rounded-2xl shadow p-6">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center">
            <span class="text-2xl">ğŸ“…</span>
          </div>
          <div>
            <p class="text-3xl font-bold text-gray-900">{{ stats.totalOrganized }}</p>
            <p class="text-sm text-gray-600">Ã‰vÃ©nement{{ stats.totalOrganized > 1 ? 's' : '' }} organisÃ©{{ stats.totalOrganized > 1 ? 's' : '' }}</p>
          </div>
        </div>
      </div>
    {% endif %}

  </div>

  <div class="grid md:grid-cols-{{ isAdmin ? '3' : '2' }} gap-6">
    
    <div class="bg-white rounded-2xl shadow p-6">
      <h3 class="font-semibold text-lg mb-4 flex items-center gap-2">
        <span class="text-2xl">âœ…</span>
        Inscrit ({{ upcomingRegistrations|length }})
      </h3>
      
      {% if upcomingRegistrations is empty %}
        <div class="text-center py-8">
          <p class="text-sm text-gray-600">Aucune inscription en cours</p>
          <a href="{{ path('event_index') }}" class="inline-block mt-3 text-green-600 hover:text-green-700 text-sm font-medium">
            DÃ©couvrir les Ã©vÃ©nements â†’
          </a>
        </div>
      {% else %}
        <div class="space-y-3">
          {% for registration in upcomingRegistrations %}
            {% set event = registration.event %}
            <a href="{{ path('event_show', {id: event.id}) }}" class="block p-3 border border-gray-200 rounded-xl hover:border-green-500 hover:bg-green-50 transition">
              <p class="font-medium text-gray-900 mb-1">{{ event.title }}</p>
              <p class="text-sm text-gray-600">ğŸ“… {{ event.eventDate|date('d/m/Y Ã  H:i') }}</p>
              <p class="text-sm text-gray-600">ğŸ“ {{ event.location.city }} â€¢ {{ event.distance }} km</p>
            </a>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    {% if isAdmin %}
      <div class="bg-white rounded-2xl shadow p-6">
        <h3 class="font-semibold text-lg mb-4 flex items-center gap-2">
          <span class="text-2xl">ğŸ¯</span>
          OrganisÃ© ({{ organizedEvents|length }})
        </h3>
        
        {% if organizedEvents is empty %}
          <div class="text-center py-8">
            <p class="text-gray-400 mb-3">ğŸ“…</p>
            <p class="text-sm text-gray-600">Vous n'avez pas encore organisÃ© d'Ã©vÃ©nement</p>
            <a href="{{ path('event_new') }}" class="inline-block mt-3 text-green-600 hover:text-green-700 text-sm font-medium">
              CrÃ©er un Ã©vÃ©nement â†’
            </a>
          </div>
        {% else %}
          <div class="space-y-3">
            {% for event in organizedEvents %}
              <a href="{{ path('event_show', {id: event.id}) }}" class="block p-3 border border-gray-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition">
                <div class="flex items-start justify-between mb-1">
                  <p class="font-medium text-gray-900">{{ event.title }}</p>
                  <span class="px-2 py-0.5 text-xs rounded-full 
                    {% if event.status.value == 'PUBLISHED' %}bg-green-100 text-green-800
                    {% elseif event.status.value == 'DRAFT' %}bg-gray-100 text-gray-800
                    {% elseif event.status.value == 'CANCELLED' %}bg-red-100 text-red-800
                    {% else %}bg-blue-100 text-blue-800{% endif %}">
                    {{ event.status.label }}
                  </span>
                </div>
                <p class="text-sm text-gray-600">ğŸ“… {{ event.eventDate|date('d/m/Y Ã  H:i') }}</p>
                <p class="text-sm text-gray-600">ğŸ“ {{ event.location.city }} â€¢ {{ event.distance }} km</p>
                <p class="text-sm text-gray-600">
                  ğŸ‘¥ {{ event.registrations|filter(r => r.status.value == 'CONFIRMED')|length }}{% if event.maxParticipants %}/{{ event.maxParticipants }}{% endif %} inscrit{{ event.registrations|length > 1 ? 's' : '' }}
                </p>
              </a>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    {% endif %}

    <div class="bg-white rounded-2xl shadow p-6">
      <h3 class="font-semibold text-lg mb-4 flex items-center gap-2">
        <span class="text-2xl">ğŸ</span>
        PassÃ©s ({{ pastRegistrations|length }})
      </h3>
      
      {% if pastRegistrations is empty %}
        <div class="text-center py-8">
          <p class="text-gray-400 mb-3">â³</p>
          <p class="text-sm text-gray-600">Aucun Ã©vÃ©nement passÃ©</p>
        </div>
      {% else %}
        <div class="space-y-3">
          {% for registration in pastRegistrations %}
            {% set event = registration.event %}
            <a href="{{ path('event_show', {id: event.id}) }}" class="block p-3 border border-gray-200 rounded-xl hover:border-gray-400 hover:bg-gray-50 transition">
              <p class="font-medium text-gray-900 mb-1">{{ event.title }}</p>
              <p class="text-sm text-gray-600">ğŸ“… {{ event.eventDate|date('d/m/Y Ã  H:i') }}</p>
              <p class="text-sm text-gray-600">ğŸ“ {{ event.location.city }} â€¢ {{ event.distance }} km</p>
            </a>
          {% endfor %}
        </div>
      {% endif %}
    </div>

  </div>

</div>
{% endblock %}
